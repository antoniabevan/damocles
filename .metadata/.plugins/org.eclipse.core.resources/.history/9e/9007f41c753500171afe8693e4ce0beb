module mcmc

    use globals
    use class_line
    use class_freq_grid
    use class_grid
    use electron_scattering
    use input
    use initialise
    use vector_functions
    use class_packet
    use radiative_transfer
    use model_comparison

    implicit none

    type mcmc_param_space
        integer :: n_points
        integer :: dimension
        real,allocatable    :: bounds(:,:)
    end type

    type(mcmc_param_space) param_space

contains

    subroutine mcmc_handler()

        !final parameter list to be explored: max velocity, min velocity, density gradient, dust mass
        !!current list: max velocity

        open(53,file='input/MCMC.in')
        read(53,*)
        read(53,*) param_space%n_points
        close(53)

        open(54,file='output/trace.out')

        do ii=1,param_space%n_points
            call run_damocles()
            write(54,*) dust_geometry%v_max,chi_sq
        end do

        close(54)

    end subroutine

    subroutine mcmc_sampler()



        param_space%dimension = 1
        allocate(bounds(param_space%dimension,2))

        bounds(1,1) = 13000
        bounds(1,2) = 20000

        !velocity test run
        do ii=1,param_space%n_points
            call random_number(ran)
            dust_geometry%v_max = bounds(1,1)+ran*(bounds(1,2)-bounds(1,1))
            print*,dust_geometry%v_max
        end do


    end subroutine

end module mcmc
